<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Alterar Senha - BioEnergy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
    }
    .form-card {
      max-width: 500px;
      margin: 80px auto;
      background-color: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .logo {
      width: 180px;
      border-radius: 12px;
    }
    .section-title {
      color: #198754;
      font-weight: 700;
      margin-bottom: 30px;
      text-align: center;
    }
    .card {
      border: none;
      border-radius: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      transition: transform 0.3s, box-shadow 0.3s;
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    .card-body {
      flex: 1;
    }
    .card:hover {
      transform: scale(1.04);
      box-shadow: 0 0 20px rgba(25, 135, 84, 0.3);
    }
    .card-img-top {
      height: 220px;
      object-fit: cover;
      border-top-left-radius: 15px;
      border-top-right-radius: 15px;
      width: 100%;
    }
    .page-title {
      text-align: center;
      color: #198754;
      font-weight: 800;
      margin: 50px 0 20px;
    }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-success">
  <div class="container">
    <img class="logo" src="/img/logo.svg" alt="imagem logo tipo">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end" id="navMenu">
      <ul class="navbar-nav align-items-center" id="navbarItems">
      </ul>
    </div>
  </div>
</nav>

<div class="form-card">
  <h4 class="text-success text-center mb-4">Alterar Senha</h4>
  <form method="POST" action="/mudar-senha">
    <div class="mb-3">
      <label for="senhaAtual" class="form-label">Senha atual</label>
      <input type="password" class="form-control" id="senhaAtual" name="senhaAtual" required>
    </div>
    <div class="mb-3">
      <label for="novaSenha" class="form-label">Nova senha</label>
      <input type="password" class="form-control" id="novaSenha" name="novaSenha" required>
    </div>
    <div class="mb-3">
      <label for="confirmarSenha" class="form-label">Confirmar nova senha</label>
      <input type="password" class="form-control" id="confirmarSenha" name="confirmarSenha" required>
    </div>
    <button type="submit" class="btn btn-success w-100">Confirmar troca</button>
  </form>
  <div class="text-center mt-3">
    <a href="/user" class="text-success" id="voltarLink">Voltar ao chatbot</a>
  </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
function realizarLogout(event) {
  event.preventDefault();
  sessionStorage.removeItem('usuarioLogado');
  sessionStorage.removeItem('logado');
  window.location.href = '/sair';
}

async function atualizarNavbar() {
  const navbarItems = document.getElementById('navbarItems');
  navbarItems.innerHTML = '';
  const voltarLink = document.getElementById('voltarLink'); 

  try {
    const response = await fetch('/session', { credentials: 'include' });
    if (!response.ok) throw new Error('Não autenticado');

    const data = await response.json();
    const usuario = data.usuario;
    const tipo = data.tipo;

    if (voltarLink) {
      if (tipo === 'admin') {
        voltarLink.textContent = 'Voltar ao painel de administração';
        voltarLink.href = '/admin';  
      } else {
        voltarLink.textContent = 'Voltar ao chatbot';
        voltarLink.href = '/user';  
      }
    }

    if (tipo === 'admin') {
      navbarItems.innerHTML = `
        <li class="nav-item"><a class="nav-link" href="/">HOME</a></li>
        <li class="nav-item"><a class="nav-link" href="/admin">ADMIN</a></li>
        <li class="nav-item"><a class="nav-link" href="/admin/usuarios">USUÁRIOS</a></li>
        <li class="nav-item"><a class="nav-link" href="/admin/manutencoes">MANUTENÇÕES</a></li>
        <li class="nav-item"><a class="nav-link" href="/admin/servicos">SERVIÇOS</a></li>
        <li class="nav-item"><a class="nav-link" href="/admin/produtos">PRODUTOS</a></li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" data-bs-toggle="dropdown">
            <i class="bi bi-person-circle fs-4 me-1"></i>
          </a>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><h6 class="dropdown-header">Informações Pessoais</h6></li>
            <li><a class="dropdown-item">Usuário: <span id="nome-usuario">${usuario}</span></a></li>
            <li><a class="dropdown-item">Acesso: ADMIN</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="/mudar-senha">Mudar Senha</a></li>
            <li><a class="dropdown-item" href="/mudar-usuario">Mudar Usuário</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-danger" href="#" onclick="realizarLogout(event)">Sair</a></li>
          </ul>
        </li>
      `;
    } else {
      // Usuário comum
      navbarItems.innerHTML = `
        <li class="nav-item"><a class="nav-link" href="/">HOME</a></li>
        <li class="nav-item"><a class="nav-link" href="/user">USER</a></li>
        <li class="nav-item"><a class="nav-link" href="/user/#chatbot">CHATBOT</a></li>
        <li class="nav-item"><a class="nav-link" href="/produtos">PRODUTOS</a></li>
        <li class="nav-item"><a class="nav-link" href="/servicos">SERVIÇOS</a></li>
        <li class="nav-item"><a class="nav-link" href="/manutencoes">MANUTENÇÕES</a></li>
        <li class="nav-item"><a class="nav-link" href="/carrinho"><i class="bi bi-cart-fill fs-4"></i></a></li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" data-bs-toggle="dropdown">
            <i class="bi bi-person-circle fs-4 me-1"></i>
          </a>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><h6 class="dropdown-header">Informações Pessoais</h6></li>
            <li><a class="dropdown-item">Usuário: <span id="nome-usuario">${usuario}</span></a></li>
            <li><a class="dropdown-item">Acesso: USUÁRIO</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="/mudar-senha">Mudar Senha</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-danger" href="#" onclick="realizarLogout(event)">Sair</a></li>
          </ul>
        </li>
      `;
    }

  } catch {
    // Visitante
    navbarItems.innerHTML = `
      <li class="nav-item"><a class="nav-link active fade-in-up" href="/">HOME</a></li>
      <li class="nav-item"><a class="nav-link fade-in-up" href="/#sobre">SOBRE</a></li>
      <li class="nav-item"><a class="nav-link fade-in-up" href="/#chatbot">CHATBOT</a></li>
      <li class="nav-item"><a class="nav-link fade-in-up" href="/#servicos">SERVIÇOS</a></li>
      <li class="nav-item"><a href="/login" class="btn btn-outline-light fw-semibold shadow-sm">Login</a></li>
      <li class="nav-item"><a href="/registro" class="btn btn-outline-light fw-semibold shadow-sm">Registre-se</a></li>
    `;
  }
}

document.addEventListener('DOMContentLoaded', atualizarNavbar);
</script>
</body>
</html>
